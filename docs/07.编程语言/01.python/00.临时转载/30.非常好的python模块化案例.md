|

### `First check`

*   [x]  æˆ‘ä½¿ç”¨GitHubæœç´¢æ‰¾åˆ°äº†ç±»ä¼¼çš„é—®é¢˜ï¼Œä½†æ²¡æœ‰æ‰¾åˆ°ã€‚
*   [x]  æˆ‘æœç´¢äº†Typeræ–‡æ¡£ï¼Œå¹¶è¿›è¡Œäº†é›†æˆæœç´¢ã€‚
*   [x]  æˆ‘å·²ç»åœ¨Googleä¸­æœç´¢äº†â€œå¦‚ä½•åœ¨Typerä¸­ä½¿ç”¨Xâ€ï¼Œä½†æ²¡æœ‰æ‰¾åˆ°ä»»ä½•ä¿¡æ¯ã€‚
*   [x]  æˆ‘å·²ç»åœ¨Googleä¸­æœç´¢äº†â€œå¦‚ä½•Xç‚¹å‡»â€ï¼Œä½†æ²¡æœ‰æ‰¾åˆ°ä»»ä½•ä¿¡æ¯ã€‚

### `Description`

æˆ‘ä¸çŸ¥é“å¦‚ä½•åœ¨æ²¡æœ‰ç¤ºä¾‹çš„æƒ…å†µä¸‹é˜æ˜è¿™ä¸ªé—®é¢˜ã€‚ å› æ­¤ï¼Œæˆ‘åœ¨å››å¤„æœå¯»æ—¶é‡åˆ°äº†ä¸€äº›éº»çƒ¦ã€‚

æˆ‘æœ‰ä¸¤ä¸ªå·²å®‰è£…çš„è½¯ä»¶åŒ…ï¼Œ `foo` å’Œ `bar` ã€‚

*   `bar` å¯ä»¥ç‹¬ç«‹äºä½¿ç”¨ `foo` ã€‚ ä¾‹å¦‚ï¼š `bar PATH` ï¼ƒ `bar` åšçš„ä¸œè¥¿æœ‰ `PATH`
*   `foo` æ¥å— `bar` ä¸ºæ’ä»¶ã€‚ ç°åœ¨ `foo` å¯ä»¥ä½¿ç”¨ä¸­çš„é€»è¾‘ `bar` ã€‚ ä¾‹å¦‚ï¼š `foo bar PATH` ã€‚ ï¼ƒ `foo` åš `bar` çš„ä¸œè¥¿æœ‰ `PATH`
*   `foo` ä¹Ÿå¯ä»¥åšå…¶ä»–å†…ç½®çš„äº‹æƒ…ã€‚ ä¾‹å¦‚ï¼š `foo fizz PATH` ã€‚ ï¼ƒ `foo` åš `fizz` çš„ä¸œè¥¿æœ‰ `PATH`
*   æˆ‘æœ‰è¿™ä¸ªå·¥ä½œï¼Œ `argparse` ä½†ä¸èƒ½ `foo bar PATH` æ­£å¸¸å·¥ä½œ `typer`

å› æ­¤ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­ã€‚

åœ¨ä¸€ä¸ªæ–‡ä»¶ `bar/src/bar/cli.py` ä¸­

```python
import typer

app = typer.Typer()

@app.command()
def main(path: str = typer.Argument(...)):
    typer.echo(f"Doing bar things to {path}")
```

å¦‚æœæˆ‘æ‰“ç”µè¯ç»™ `bar --help` æˆ‘

```
Usage: bar [OPTIONS] PATH

Options:
  --install-completion [bash|zsh|fish|powershell|pwsh]
                                  Install completion for the specified shell.
  --show-completion [bash|zsh|fish|powershell|pwsh]
                                  Show completion for the specified shell, to
                                  copy it or customize the installation.

  --help                          Show this message and exit.

```

å¤ªå¥½äº†

è¿™æ˜¯ `setup.py` ä» è¿™é‡Œå®‰è£…çš„ `bar/setup.py`

```python
"""Setup."""

from setuptools import find_packages
from setuptools import setup

PACKAGE_NAME = "bar"

setup(
    name=PACKAGE_NAME,
    version="0.0.1",
    package_dir={"": "src"},
    packages=find_packages(where="src"),
    zip_safe=False,
    include_package_data=True,
    python_requires=">=3.7",
    entry_points={
        "console_scripts": [f"{PACKAGE_NAME} = {PACKAGE_NAME}.cli:app"],
        "foo.cli_plugins": [f"{PACKAGE_NAME} = {PACKAGE_NAME}.cli"],
    },
    install_requires=["typer"],
)
```

*   ä¹Ÿæœ‰ä¸€ä¸ªç©º `__init__.py` çš„ `bar/src/bar/`

åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ `foo/src/foo/cli.py` ä¸­

```python
import typer
import pkg_resources

app = typer.Typer()

# real program has lots of plugins
CLI_PLUGINS = {
            entry_point.name: entry_point.load()
            for entry_point in pkg_resources.iter_entry_points("foo.cli_plugins")
        }

for name, entry_point in CLI_PLUGINS.items():
    app.add_typer(entry_point.app, name=name)

@app.command()
def fizz(path: str = typer.Argument(...)):
    typer.echo(f"Fizzy {path}")
```

è¿™æ˜¯ `setup.py` ä» è¿™é‡Œå®‰è£…çš„ `foo/setup.py`

```python
"""Setup."""

from pathlib import Path

from setuptools import find_packages
from setuptools import setup

PACKAGE_NAME = "foo"

setup(
    name=PACKAGE_NAME,
    version="0.0.1",
    package_dir={"": "src"},
    packages=find_packages(where="src"),
    zip_safe=False,
    include_package_data=True,
    python_requires=">=3.7",
    entry_points={
        "console_scripts": [f"{PACKAGE_NAME} = {PACKAGE_NAME}.cli:app"],
    },
    install_requires=["typer"],
)
```

*   ä¹Ÿæœ‰ä¸€ä¸ªç©º `__init__.py` çš„ `foo/src/foo/`

å½“æˆ‘æ‰“ç”µè¯ç»™ `foo --help` æˆ‘

```
Usage: ex-primary [OPTIONS] COMMAND [ARGS]...

Options:
  --install-completion [bash|zsh|fish|powershell|pwsh]
                                  Install completion for the specified shell.
  --show-completion [bash|zsh|fish|powershell|pwsh]
                                  Show completion for the specified shell, to
                                  copy it or customize the installation.

  --help                          Show this message and exit.

Commands:
  fizz
  bar

```

è¿™ä¹Ÿå¾ˆæ£’ã€‚ è¿™æ­£æ˜¯æˆ‘æƒ³è¦çš„ã€‚

ç„¶è€Œ..

å½“æˆ‘æ‰“ç”µè¯ç»™ `foo bar --help` æˆ‘

```
Usage: foo bar [OPTIONS] COMMAND [ARGS]...

Options:
  --help  Show this message and exit.

Commands:
  main

```

è¿™ä¸æ˜¯æˆ‘æƒ³è¦çš„ã€‚ æˆ‘ä¸æƒ³åœ¨ `main` è¿™é‡Œ å–Šå‡º åå­—ã€‚

## `Question`

*   æœ‰æ²¡æœ‰åŠæ³•åœ¨ `main` è¿™é‡Œ æ²¡æœ‰ å‘½ä»¤ï¼Ÿ æˆ‘å¸Œæœ›èƒ½å¤Ÿæ‰“ç”µè¯ `foo bar PATH` è€Œä¸æ˜¯ `foo bar main PATH` ã€‚

æˆ‘æƒ³è¦çš„ `for bar --help` æ˜¯

```
Usage: foo bar [OPTIONS] PATH

Options:
  --install-completion [bash|zsh|fish|powershell|pwsh]
                                  Install completion for the specified shell.
  --show-completion [bash|zsh|fish|powershell|pwsh]
                                  Show completion for the specified shell, to
                                  copy it or customize the installation.

  --help                          Show this message and exit.

```

### `Additional context`

æˆ‘å·²ç»å°è¯•å°†å›è°ƒæ·»åŠ åˆ°ï¼Œ `add_typer` å¹¶ä¸”å‡ ä¹å¯ä»¥å®Œæˆæˆ‘æƒ³è¦çš„æ“ä½œã€‚
ä¾‹å¦‚ï¼š
å˜åŒ–ä¸­

```python
app.add_typer(entry_point.app, name=name)
```

è‡³

```python
app.add_typer(entry_point.app, name=name, callback=entry_point.main)
```

*   è¿™æ ·åšä¼šå¢åŠ  ï¼ˆyayï¼‰ `bar` ç”¨æ³• çš„è®ºç‚¹ï¼Œ `foo bar --help` ä½†ä»ç„¶ç•™ä¸‹ `COMMAND [ARGS]` and `Commands` éƒ¨åˆ†ã€‚ è€Œä¸”æˆ‘ä¹Ÿä¸è®¤ä¸ºè¿™æ˜¯è§£å†³æ­¤é—®é¢˜çš„æ­£ç¡®æ–¹æ³•ã€‚

æˆ‘è§‰å¾—æœ‰ä¸€ç§å¾ˆå¥½çš„æ–¹æ³•å¯ä»¥ä½¿å®ƒæ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯æˆ‘çœ‹ä¸åˆ°å®ƒã€‚

æˆ‘çœ‹äº†ä¸€ä¸‹æ–‡æ¡£ï¼ˆå¾ˆ *æ¼‚äº®* ï¼‰ï¼Œå¹¶ä¸”å¸¦æœ‰å­å‘½ä»¤çš„ç¤ºä¾‹ä¸è¯¥ç”¨ä¾‹ä¸å¤ªåŒ¹é…ã€‚ åœ¨é‚£é‡Œï¼Œå­å‘½ä»¤è¢«è®¾è®¡ä¸ºæ˜¾å¼è°ƒç”¨ã€‚

å¦‚æœæˆ‘èƒ½æä¾›æ›´å¤šä¿¡æ¯ï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚

è°¢è°¢æ‚¨çš„å‡ºè‰²å·¥ä½œ `typer` ï¼ å¹²æ¯

 |
|

The text was updated successfully, but these errors were encountered:

 |

Pick your reaction

  ğŸ‘   ğŸ‘   ğŸ˜„   ğŸ‰   ğŸ˜•   â¤ï¸   ğŸš€  ğŸ‘€

[![@å®‰å¾·é²Â·è°¢é‡Œä¸¹](https://avatars2.githubusercontent.com/u/50179676?s=60&u=6c3253a827d85caf111a4ff644782e2a4958ca7e&v=4)](https://github.com/Andrew-Sheridan) [  Andrew\-Sheridan  ](https://github.com/Andrew-Sheridan)   æ·»åŠ äº†   [   é¢˜   ](https://github.com/tiangolo/typer/labels/question "éœ€è¦æ›´å¤šä¿¡æ¯")   æ ‡ç­¾   [on 14 Jun 2020](#event-3440928334)

[![@å®‰å¾·é²Â·è°¢é‡Œä¸¹](https://avatars1.githubusercontent.com/u/50179676?s=88&u=6c3253a827d85caf111a4ff644782e2a4958ca7e&v=4)](https://github.com/Andrew-Sheridan)

Pick your reaction

  ğŸ‘   ğŸ‘   ğŸ˜„   ğŸ‰   ğŸ˜•   â¤ï¸   ğŸš€  ğŸ‘€

Sorry, something went wrong.

ä½œè€…

###  `[![@Andrew-Sheridan](https://avatars2.githubusercontent.com/u/50179676?s=60&u=6c3253a827d85caf111a4ff644782e2a4958ca7e&v=4)](https://github.com/Andrew-Sheridan) ** [Andrew-Sheridan](https://github.com/Andrew-Sheridan) ** commented [on 14 Jun 2020](#issuecomment-643702027)`

|

æˆ‘ç©äº†ä¸€æ®µæ—¶é—´ï¼Œå¹¶æå‡ºäº†ä¸€ä¸ªæ½œåœ¨çš„è§£å†³æ–¹æ¡ˆï¼š

æ›´æ”¹æ­¤ï¼š

```python
for name, entry_point in CLI_PLUGINS.items():
    app.add_typer(entry_point.app, name=name)
```

å¯¹æ­¤ï¼š

```python
for name, entry_point in CLI_PLUGINS.items():
    app.registered_commands.append(CommandInfo(name=name, callback=entry_point.main))
```

è¿™ *ä¼¼ä¹* å·¥ä½œã€‚

æœ‰ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•å—ï¼Ÿ

è¿™ç§æ–¹æ³•ä¼šå¸¦æ¥æ„æƒ³ä¸åˆ°çš„åæœå—ï¼Ÿ æˆ‘ `registered_commands` åœ¨ [https://typer.tiangolo.com/](https://typer.tiangolo.com/) ä¸Šæ²¡æœ‰ä»»ä½•æ–‡æ¡£ï¼Œå¹¶ä¸”æºä»£ç ä¸­æ²¡æœ‰æ–‡æ¡£å­—ç¬¦ä¸²ã€‚

å†æ¬¡æ„Ÿè°¢æ‚¨æŠ½å‡ºå®è´µçš„æ—¶é—´ï¼Œå¯¹æ–‡æœ¬å¢™è¡¨ç¤ºæ­‰æ„ã€‚

 |

Pick your reaction

  ğŸ‘   ğŸ‘   ğŸ˜„   ğŸ‰   ğŸ˜•   â¤ï¸   ğŸš€  ğŸ‘€

[![@tiangolo](https://avatars1.githubusercontent.com/u/1326112?s=88&u=05f95ca7fdead36edd9c86be46b4ef6c3c71f876&v=4)](https://github.com/tiangolo)

Pick your reaction

  ğŸ‘   ğŸ‘   ğŸ˜„   ğŸ‰   ğŸ˜•   â¤ï¸   ğŸš€  ğŸ‘€

Sorry, something went wrong.

æ‰€æœ‰è€…

###  `[![@tiangolo](https://avatars2.githubusercontent.com/u/1326112?s=60&u=05f95ca7fdead36edd9c86be46b4ef6c3c71f876&v=4)](https://github.com/tiangolo) ** [tiangolo](https://github.com/tiangolo) ** commented [on 18 Jun 2020](#issuecomment-645530433)`

|

å˜¿ [@ Andrew\-Sheridan](https://github.com/Andrew-Sheridan) ï¼Œè¿™æ˜¯ç¬¬ä¸€ç§æƒ…å†µï¼Œå½“æ‚¨è¿™æ ·åšæ—¶ `@app.command()` ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªåŠŸèƒ½ï¼Œè€Œæ²¡æœ‰åˆ«çš„ï¼Œå®ƒè¢«ç”¨ä½œå•ä¸ªå‘½ä»¤ï¼Œè€Œä¸æ˜¯ä¸€ç»„å‘½ä»¤ã€‚

åœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œç”±äºå®ƒä½œä¸ºä¸»åº”ç”¨ç¨‹åºçš„å­å‘½ä»¤åŒ…å«åœ¨å…¶ä¸­ï¼Œå¹¶ä¸”å®ƒæ˜¯ä¸€ä¸ªå®Œæ•´çš„Typeråº”ç”¨ç¨‹åºï¼Œå› æ­¤å®ƒä¸èƒ½å†å‡å®šå®ƒåªæ˜¯ä¸€ä¸ªç®€å•çš„å‘½ä»¤è€Œå°†å…¶è§†ä¸ºä¸€ä¸ªç»„ï¼Œæ— è®ºæ˜¯å¦å®ƒå…·æœ‰ä¸€ä¸ªæˆ–å‡ ä¸ªå­å‘½ä»¤ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘è®¤ä¸ºæ‚¨å¯ä»¥ä»ä¸€å¼€å§‹å°±æ˜¾å¼åœ°ä½¿å…¶æˆä¸ºä¸€ä¸ªç»„ï¼Œè€Œä¸ä½¿ç”¨ `@app.command()` but `@app.callback()` ã€‚

çš„ `callback` æ˜¯ä¸€ç»„ï¼ˆè€Œä¸æ˜¯ä¸€ä¸ªå‘½ä»¤ï¼‰çš„ä¸»è¦åŠŸèƒ½ï¼Œä½†å®ƒè¢«è§†ä¸ºå¯¹äºè¢«å§‹ç»ˆè¿è¡Œä¸ç®¡æ˜¯å¦æœ‰å­å‘½ä»¤è¯¥ç»„çš„ä¸»å‡½æ•°ã€‚

è¿™æ ·ï¼Œå®ƒå°†åœ¨æ‚¨å•ç‹¬è°ƒç”¨ç¬¬ä¸€ä¸ªç‰ˆæœ¬æ—¶ç›´æ¥è¿è¡Œï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨æ—¶å¯ä»¥æ­£å¸¸å·¥ä½œ `app.add_typer()` ï¼ˆæ— éœ€åˆ›å»ºç¬¬äºŒä¸ªå­å‘½ä»¤ï¼‰ã€‚

ä¹Ÿè®¸è¿™é‡Œçš„æ–‡æ¡£å¯ä»¥å¸®åŠ©æ‚¨ï¼š [https](https://typer.tiangolo.com/tutorial/commands/callback/) : [//typer.tiangolo.com/tutorial/commands/callback/](https://typer.tiangolo.com/tutorial/commands/callback/)

 |

Pick your reaction

  ğŸ‘   ğŸ‘   ğŸ˜„   ğŸ‰   ğŸ˜•   â¤ï¸   ğŸš€  ğŸ‘€

[![@tiangolo](https://avatars2.githubusercontent.com/u/1326112?s=60&u=05f95ca7fdead36edd9c86be46b4ef6c3c71f876&v=4)](https://github.com/tiangolo) [  tiangolo  ](https://github.com/tiangolo)   æ·»åŠ äº†   [   å·²å›ç­”   ](https://github.com/tiangolo/typer/labels/answered)   æ ‡ç­¾   [on 18 Jun 2020](#event-3454775980)

[![@å®‰å¾·é²Â·è°¢é‡Œä¸¹](https://avatars1.githubusercontent.com/u/50179676?s=88&u=6c3253a827d85caf111a4ff644782e2a4958ca7e&v=4)](https://github.com/Andrew-Sheridan)

Pick your reaction

  ğŸ‘   ğŸ‘   ğŸ˜„   ğŸ‰   ğŸ˜•   â¤ï¸   ğŸš€  ğŸ‘€

Sorry, something went wrong.

ä½œè€…

###  `[![@Andrew-Sheridan](https://avatars2.githubusercontent.com/u/50179676?s=60&u=6c3253a827d85caf111a4ff644782e2a4958ca7e&v=4)](https://github.com/Andrew-Sheridan) ** [Andrew-Sheridan](https://github.com/Andrew-Sheridan) ** commented [on 18 Jun 2020](#issuecomment-645672633)`

|

[@tiangolo](https://github.com/tiangolo) è°¢è°¢å›ç­”ï¼

æ‚¨çš„è§£é‡Šä¼¼ä¹å¾ˆåˆç†ï¼Œä½†å®é™…ä¸Šæˆ‘ä¼¼ä¹æ— æ³•æ­£ç¡®å®ç°ã€‚ æˆ‘å·²ç»é˜…è¯»äº†æ–‡æ¡£å’Œç¤ºä¾‹ï¼Œä½†ä¸€å®šä¸èƒ½å•å‡»ã€‚

å¦‚æœæˆ‘å°† `main` in `bar.py` ï¼ˆæ’ä»¶ï¼‰è®¾ç½®ä¸ºå›è°ƒï¼Œåˆ™å°† `bar` æ— æ³•ä½¿ç”¨ã€‚

`bar.py`

```python
import typer

app = typer.Typer()

@app.callback()
def main(path: str = typer.Argument(...)):
    typer.echo(f"Doing bar things to {path}")
```

`help`

```
$ bar --help
Usage: bar [OPTIONS] PATH COMMAND [ARGS]...

Options:
  --install-completion [bash|zsh|fish|powershell|pwsh]
                                  Install completion for the specified shell.
  --show-completion [bash|zsh|fish|powershell|pwsh]
                                  Show completion for the specified shell, to
                                  copy it or customize the installation.

  --help

```

`usage`

```
$ bar some_path
Usage: bar [OPTIONS] PATH COMMAND [ARGS]...
Try 'bar --help' for help.

Error: Missing command.

```

æ‚¨ä¼šçœ‹åˆ°å®ƒåœ¨æ²¡æœ‰å‘½ä»¤æ—¶è¦æ±‚ä¸€ä¸ªå‘½ä»¤ã€‚ ä½¿ç”¨è°ƒç”¨ç›¸åŒçš„é—®é¢˜ `foo bar some_path` ã€‚

æˆ‘æ˜¯å¦ç¼ºå°‘æ­¤æ–¹é¢çš„å†…å®¹ï¼Œè¿˜æ˜¯åº”è¯¥é€€å› `app.registered_commands` ä¼¼ä¹æœ‰æ•ˆ çš„æœªè®°å½•æ–‡æ¡£ ï¼Ÿ

å†æ¬¡æ„Ÿè°¢ä½ 

 |

Pick your reaction

  ğŸ‘   ğŸ‘   ğŸ˜„   ğŸ‰   ğŸ˜•   â¤ï¸   ğŸš€  ğŸ‘€

[![@ github-actions](https://avatars3.githubusercontent.com/in/15368?s=60&v=4)](https://github.com/apps/github-actions) [  githubåŠ¨ä½œ  ](https://github.com/apps/github-actions) æœºå™¨äºº   åˆ é™¤äº†   [   å·²å›ç­”   ](https://github.com/tiangolo/typer/labels/answered)   æ ‡ç­¾   [on 18 Jun 2020](#event-3455730852)

[![@cataerogong](https://avatars3.githubusercontent.com/u/54147585?s=88&u=e1ff02108177dc72c727ec91a3f0c37c8028fa31&v=4)](https://github.com/cataerogong)

Pick your reaction

  ğŸ‘   ğŸ‘   ğŸ˜„   ğŸ‰   ğŸ˜•   â¤ï¸   ğŸš€  ğŸ‘€

Sorry, something went wrong.

###  `[![@cataerogong](https://avatars0.githubusercontent.com/u/54147585?s=60&u=e1ff02108177dc72c727ec91a3f0c37c8028fa31&v=4)](https://github.com/cataerogong) ** [cataerogong](https://github.com/cataerogong) ** commented [on 11 Jul 2020](#issuecomment-657052031)  â€¢

edited`

|

[@ Andrew\-Sheridan](https://github.com/Andrew-Sheridan)
æˆ‘æœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œä¹Ÿè®¸ä¸æ˜¯é‚£ä¹ˆæ¼‚äº® ğŸ˜º

[@tiangolo](https://github.com/tiangolo)
ä¹Ÿè®¸ `Typer.add_typer()` æ–¹æ³• çš„è¡Œä¸º å¯èƒ½ä¼šæ›´æ”¹ä¸ºï¼šå½“å­ç±»å‹è¾“å…¥å™¨åªæœ‰1ä¸ªå‘½ä»¤æ—¶ï¼Œå°†å…¶æ·»åŠ ä¸ºå‘½ä»¤ï¼Œè€Œä¸æ˜¯å­å‘½ä»¤ç»„ã€‚

---

## `code`

### `sub.py`

```python
import typer

app = typer.Typer()

@app.command()
def main(arg: str):
    typer.echo(f'sub(arg={arg})')

if __name__ == "__main__":
    app()
```

### `sub2.py`

```python
import typer

app = typer.Typer()

@app.command()
def cmd1(arg: str):
    typer.echo(f'sub2.cmd1(arg={arg})')

@app.command()
def cmd2(arg: str):
    typer.echo(f'sub2.cmd2(arg={arg})')

if __name__ == "__main__":
    app()
```

### `main.py`

```python
import typer
import sub, sub2

app = typer.Typer()

@app.command()
def main(arg: str):
    typer.echo(f'main(arg={arg})')

if __name__ == "__main__":
    if len(sub.app.registered_commands) == 1:
        app.command('sub')(sub.app.registered_commands[0].callback)
    else:
        app.add_typer(sub.app, name='sub')
    if len(sub2.app.registered_commands) == 1:
        app.command('sub2')(sub2.app.registered_commands[0].callback)
    else:
        app.add_typer(sub2.app, name='sub2')
    app()
```

---

## `run`

### `main.py`

```shell
$ python main.py --help
Usage: main.py [OPTIONS] COMMAND [ARGS]...

Options:
  --install-completion [bash|zsh|fish|powershell|pwsh]
                                  Install completion for the specified shell.
  --show-completion [bash|zsh|fish|powershell|pwsh]
                                  Show completion for the specified shell, to
                                  copy it or customize the installation.

  --help                          Show this message and exit.

Commands:
  main
  sub
  sub2

$ python main.py main --help
Usage: main.py main [OPTIONS] ARG

Arguments:
  ARG  [required]

Options:
  --help  Show this message and exit.

$ python main.py sub --help
Usage: main.py sub [OPTIONS] ARG

Arguments:
  ARG  [required]

Options:
  --help  Show this message and exit.

$ python main.py sub2 --help
Usage: main.py sub2 [OPTIONS] COMMAND [ARGS]...

Options:
  --help  Show this message and exit.

Commands:
  cmd1
  cmd2

$ python main.py sub2 cmd1 --help
Usage: main.py sub2 cmd1 [OPTIONS] ARG

Arguments:
  ARG  [required]

Options:
  --help  Show this message and exit.

$ python main.py sub2 cmd2 --help
Usage: main.py sub2 cmd2 [OPTIONS] ARG

Arguments:
  ARG  [required]

Options:
  --help  Show this message and exit.

$ python main.py main sth
main(arg=sth)

$ python main.py sub sth
sub(arg=sth)

$ python main.py sub2 cmd1 sth
sub2.cmd1(arg=sth)

$ python main.py sub2 cmd2 sth
sub2.cmd2(arg=sth)
```

### `sub.py`

```shell
$ python sub.py --help
Usage: sub.py [OPTIONS] ARG

Arguments:
  ARG  [required]

Options:
  --install-completion [bash|zsh|fish|powershell|pwsh]
                                  Install completion for the specified shell.
  --show-completion [bash|zsh|fish|powershell|pwsh]
                                  Show completion for the specified shell, to
                                  copy it or customize the installation.

  --help                          Show this message and exit.

$ python sub.py sth
sub(arg=sth)
```

### `sub2.py`

```shell
$ python sub2.py --help
Usage: sub2.py [OPTIONS] COMMAND [ARGS]...

Options:
  --install-completion [bash|zsh|fish|powershell|pwsh]
                                  Install completion for the specified shell.
  --show-completion [bash|zsh|fish|powershell|pwsh]
                                  Show completion for the specified shell, to
                                  copy it or customize the installation.

  --help                          Show this message and exit.

Commands:
  cmd1
  cmd2

$ python sub2.py cmd1 --help
Usage: sub2.py cmd1 [OPTIONS] ARG

Arguments:
  ARG  [required]

Options:
  --help  Show this message and exit.

$ python sub2.py cmd2 --help
Usage: sub2.py cmd2 [OPTIONS] ARG

Arguments:
  ARG  [required]

Options:
  --help  Show this message and exit.

$ python sub2.py cmd1 sth
sub2.cmd1(arg=sth)

$ python sub2.py cmd2 sth
sub2.cmd2(arg=sth)
```

 |

é€‰æ‹©ä½ çš„ååº”

  ğŸ‘   ğŸ‘   ğŸ˜„   ğŸ‰   ğŸ˜•   â¤ï¸   ğŸš€  ğŸ‘€

[![@vlcinsky](https://avatars2.githubusercontent.com/u/635911?s=88&u=80ef3bf581f32c5057ee38a32566b5b9b0bb6611&v=4)](https://github.com/vlcinsky)

Pick your reaction

  ğŸ‘   ğŸ‘   ğŸ˜„   ğŸ‰   ğŸ˜•   â¤ï¸   ğŸš€  ğŸ‘€

Sorry, something went wrong.

###  `[![@vlcinsky](https://avatars1.githubusercontent.com/u/635911?s=60&u=80ef3bf581f32c5057ee38a32566b5b9b0bb6611&v=4)](https://github.com/vlcinsky) ** [vlcinsky](https://github.com/vlcinsky) ** commented [on 13 Jul 2020](#issuecomment-657245317)  â€¢

edited`

|

å¹²å¾—å¥½ [@cataerogong](https://github.com/cataerogong)

æˆ‘æœ‰ç±»ä¼¼çš„é—®é¢˜ï¼Œä½†å°±æˆ‘è€Œè¨€ï¼Œæˆ‘çŸ¥é“ï¼Œä¸€æ—¦æˆ‘è¦æ·»åŠ å‘½ä»¤ç»„ï¼Œåˆ™éœ€è¦å¦ä¸€ä¸ªæ—¶é—´å­å‘½ä»¤ã€‚ å¯¹äºä»¥åçš„å¯è°ƒç”¨å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡ç®€å•åœ°æ³¨å†Œ `app.command(name="whatever")(callable)` ã€‚

## `user.py`

```python
import typer

app = typer.Typer()

@app.command()
def create(name: str):
    """Create user
    """
    typer.echo(f"Creating user: {name}")

@app.command()
def delete(name: str):
    """Delete user
    """
    typer.echo(f"Deleting user: {name}")

if __name__ == "__main__":
    app()
```

## `hello.py`

```python
import typer

app = typer.Typer()

@app.command(name="hello")
def action(name: str):
    """Say Hello to NAME.
    """
    typer.echo(f"Hello {name}")

if __name__ == "__main__":
    app()
```

## `main.py`

```python
import typer

import hello
import user

app = typer.Typer()

app.command(name="hello")(hello.action)
app.add_typer(user.app, name="user")

if __name__ == "__main__":
    app()
```

åœ¨Typerä¸ä¼šä¿®æ”¹callable `hello` ï¼Œå®ƒå¯ä»¥ç®€å•åœ°åœ¨ä»»ä½•å…¶ä»–Typer `app` å®ä¾‹ä¸­ æ³¨å†Œ ã€‚

## `Implicit expectations`

ç”±äºåœ¨è¿™ä¸ªé—®é¢˜ä¸Šçœ‹åˆ°ï¼Œæœ‰æ›´å¤šçš„ç”¨æˆ·å…·æœ‰ç›¸åŒçš„é¢„æœŸï¼Œå³ `app.add_typer` åœ¨ `app` åªæœ‰å•ä¸ªå­å‘½ä»¤å°†ä¸ä¼šäº§ç”Ÿé¢å¤–çš„å‘½ä»¤ç»„æ·»åŠ åªæœ‰ä¸€ä¸ªçº§åˆ«çš„å‘½ä»¤ã€‚

å¦‚æœTyperå°†ä»¥è¿™ç§æ–¹å¼ï¼ˆæš—ä¸­é¢„æœŸï¼‰å·¥ä½œï¼Œé‚£å°†æ˜¯å¾ˆå¥½çš„ã€‚ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™æ˜¯Typerä»¤æˆ‘æƒŠè®¶çš„å”¯ä¸€æƒ…å†µã€‚ ä¼Ÿå¤§çš„å·¥ä½œ [@tiangolo](https://github.com/tiangolo) ã€‚

 |

ğŸš€ 1ä¸ª

Pick your reaction

  ğŸ‘   ğŸ‘   ğŸ˜„   ğŸ‰   ğŸ˜•   â¤ï¸   ğŸš€  ğŸ‘€

[![@andrewasheridan](https://avatars1.githubusercontent.com/u/38504307?s=88&u=ada9860f2be385c72e0c1955fa765b1e401629d4&v=4)](https://github.com/andrewasheridan)

Pick your reaction

  ğŸ‘   ğŸ‘   ğŸ˜„   ğŸ‰   ğŸ˜•   â¤ï¸   ğŸš€  ğŸ‘€

Sorry, something went wrong.

###  `[![@andrewasheridan](https://avatars2.githubusercontent.com/u/38504307?s=60&u=ada9860f2be385c72e0c1955fa765b1e401629d4&v=4)](https://github.com/andrewasheridan) ** [andrewasheridan](https://github.com/andrewasheridan) ** commented [on 14 Jul 2020](#issuecomment-658117105)`

|

è°¢è°¢æ‚¨çš„æ„è§å’Œå»ºè®®ï¼ å‘¨æœ«æˆ‘å°†æ›´æ·±å…¥åœ°å®¡æŸ¥è¿™äº›å†…å®¹ã€‚

åŒæ—¶ï¼Œæˆ‘å¾ˆå¥½å¥‡æ˜¯å¦æœ‰äººå¯ä»¥åœ¨æˆ‘çš„ç¬”è®°ä¸­è¯„è®ºï¿¼ `app.registered_commands.append` ï¼Ÿ

 |

Pick your reaction

  ğŸ‘   ğŸ‘   ğŸ˜„   ğŸ‰   ğŸ˜•   â¤ï¸   ğŸš€  ğŸ‘€

[![@pmsoltani](https://avatars1.githubusercontent.com/u/25427031?s=88&u=dbb450be8eddcc41630870226bd2fcc328757cd7&v=4)](https://github.com/pmsoltani)

Pick your reaction

  ğŸ‘   ğŸ‘   ğŸ˜„   ğŸ‰   ğŸ˜•   â¤ï¸   ğŸš€  ğŸ‘€

Sorry, something went wrong.

###  `[![@pmsoltani](https://avatars2.githubusercontent.com/u/25427031?s=60&u=dbb450be8eddcc41630870226bd2fcc328757cd7&v=4)](https://github.com/pmsoltani) ** [pmsoltani](https://github.com/pmsoltani) ** commented [on 1 Sep 2020](#issuecomment-684053701)`

|

åœ¨Typer v0.3.2ä¸Šè¿è¡Œæ—¶ï¼Œæˆ‘ä»…ç”¨1æ¡å‘½ä»¤å°è¯•äº†ä¸Šè¿°æ‰€æœ‰å…³äºå­æ¨¡å—çš„å»ºè®®ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œå®ƒä»¬ä¼¼ä¹éƒ½ä¸èµ·ä½œç”¨ ğŸ˜•

 |

Pick your reaction

  ğŸ‘   ğŸ‘   ğŸ˜„   ğŸ‰   ğŸ˜•   â¤ï¸   ğŸš€  ğŸ‘€

[![@andrewasheridan](https://avatars1.githubusercontent.com/u/38504307?s=88&u=ada9860f2be385c72e0c1955fa765b1e401629d4&v=4)](https://github.com/andrewasheridan)

Pick your reaction

  ğŸ‘   ğŸ‘   ğŸ˜„   ğŸ‰   ğŸ˜•   â¤ï¸   ğŸš€  ğŸ‘€

Sorry, something went wrong.

###  `[![@andrewasheridan](https://avatars2.githubusercontent.com/u/38504307?s=60&u=ada9860f2be385c72e0c1955fa765b1e401629d4&v=4)](https://github.com/andrewasheridan) ** [andrewasheridan](https://github.com/andrewasheridan) ** commented [on 1 Sep 2020](#issuecomment-684063539)`

|

`app.registered_commands.append(CommandInfo(name=name, callback=entry_point.main))` é‚£å°šæœªè§£å†³ çš„ æ–¹æ³•å‘¢ï¼Ÿ

 |

Pick your reaction

  ğŸ‘   ğŸ‘   ğŸ˜„   ğŸ‰   ğŸ˜•   â¤ï¸   ğŸš€  ğŸ‘€

[![@pmsoltani](https://avatars1.githubusercontent.com/u/25427031?s=88&u=dbb450be8eddcc41630870226bd2fcc328757cd7&v=4)](https://github.com/pmsoltani)

Pick your reaction

  ğŸ‘   ğŸ‘   ğŸ˜„   ğŸ‰   ğŸ˜•   â¤ï¸   ğŸš€  ğŸ‘€

Sorry, something went wrong.

###  `[![@pmsoltani](https://avatars2.githubusercontent.com/u/25427031?s=60&u=dbb450be8eddcc41630870226bd2fcc328757cd7&v=4)](https://github.com/pmsoltani) ** [pmsoltani](https://github.com/pmsoltani) ** commented [on 1 Sep 2020](#issuecomment-684172357)  â€¢

edited`

|

[@andrewasheridan](https://github.com/andrewasheridan) ä¹Ÿæ˜¯ã€‚ æˆ‘ä»é¡¶éƒ¨å¼€å§‹ã€‚ è¿™æ˜¯æˆ‘çš„é¡¹ç›®ç»“æ„ï¼š

```
.
â”œâ”€â”€ main.py (FastAPI)
â””â”€â”€ cli
    â”œâ”€â”€ commands
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â””â”€â”€ cmd_crawl.py
    â”œâ”€â”€ __init__.py
    â””â”€â”€ cli.py

```

`cmd_crawl.py` ï¼š

```python
import typer

cli = typer.Typer()

def arg_check(values: List[str]) -> List[str]:
    for value in values:
        if value not in ['wikipedia', 'reddit']:
            raise typer.BadParameter(f"Bad value '{value}'.")
    return values

@cli.command()
def crawl(websites: List[str] = typer.Argument(..., callback=arg_check)):
    typer.echo(websites)
```

`cli.py` ï¼ˆåˆå§‹ç‰ˆæœ¬ï¼‰ï¼š

```python
import typer

from cli.commands import cmd_crawl

cli = typer.Typer()
cli.add_typer(cmd_crawl.cli, name="crawl")
```

è¿™ä¼šè®©æˆ‘åœ¨ç»ˆç«¯ä¸­è¾“å…¥ï¼š `proj crawl crawl wikipedia` è€Œä¸æ˜¯ `proj crawl wikipedia` ï¼Œä½†å®ƒå¯ä»¥å·¥ä½œã€‚ æ‚¨çš„è§£å†³æ–¹æ¡ˆï¼ˆåŠå…¶ä»–ï¼‰ï¼š

`cli.py` ï¼ˆæ–°ç‰ˆæœ¬ï¼‰ï¼š

```python
import typer
from typer.models import CommandInfo

from cli.commands import cmd_crawl

cli = typer.Typer()
cli.registered_commands.append(CommandInfo(name="crawl", callback=cmd_crawl.crawl))
```

ç°åœ¨ï¼Œè¿™äº›æ— æ•ˆï¼š
`proj crawl wikipedia` \-> `Error: Invalid value for 'ENGINES...': Bad value 'crawl'.`
`proj crawl crawl wikipedia` \-> `Error: Invalid value for 'ENGINES...': Bad value 'crawl'.`

ä½†è¿™ç¡®å®ï¼ˆä¸æ˜¯æˆ‘æƒ³è¦çš„ï¼‰ï¼š
`proj wikipedia` \->å¥½ï¼

 |

Pick your reaction

  ğŸ‘   ğŸ‘   ğŸ˜„   ğŸ‰   ğŸ˜•   â¤ï¸   ğŸš€  ğŸ‘€

[![@pmsoltani](https://avatars1.githubusercontent.com/u/25427031?s=88&u=dbb450be8eddcc41630870226bd2fcc328757cd7&v=4)](https://github.com/pmsoltani)

Pick your reaction

  ğŸ‘   ğŸ‘   ğŸ˜„   ğŸ‰   ğŸ˜•   â¤ï¸   ğŸš€  ğŸ‘€

Sorry, something went wrong.



|

å¥½...æˆ‘è§£å†³äº†æˆ‘çš„é—®é¢˜ï¼š

`cmd_crawl.py` ï¼š

```python
import typer

# cli = typer.Typer() -> No need to create a Typer app instance

def arg_check(values: List[str]) -> List[str]:
    for value in values:
        if value not in ['wikipedia', 'reddit']:
            raise typer.BadParameter(f"Bad value '{value}'.")
    return values

# @cli.command() -> We just need to have a simple function.
def crawl(websites: List[str] = typer.Argument(..., callback=arg_check)):
    typer.echo(websites)
```

`cli.py` ï¼ˆå½“å‰ç‰ˆæœ¬ï¼‰ï¼š

```python
import typer

from cli.commands import cmd_crawl

cli = typer.Typer()
# cli.add_typer(cmd_crawl.cli, name="crawl")
cli.command(name="crawl")(cmd_crawl.crawl)
```

ç°åœ¨å¯ä»¥ä½¿ç”¨ï¼š `proj crawl wikipedia` ã€‚ è¯·æ³¨æ„ï¼Œè¿™ä¸ [@vlcinsky](https://github.com/vlcinsky) çš„è§£å†³æ–¹æ¡ˆ ä¸åŒ ï¼Œå› ä¸ºä»–å°†å­æ¨¡å— `hello.py` å˜æˆäº†Typeråº”ç”¨ç¨‹åºï¼Œè€Œæˆ‘æ²¡æœ‰ã€‚ æ— è®ºå¦‚ä½•ï¼Œæˆ‘çš„ç›®æ ‡åªæ˜¯å°†ä»£ç åˆ†æˆè¾ƒå°çš„æ¨¡å—ï¼Œè€Œæˆ‘å¹¶ä¸ä¸€å®šéœ€è¦å­å‘½ä»¤ã€‚

 |
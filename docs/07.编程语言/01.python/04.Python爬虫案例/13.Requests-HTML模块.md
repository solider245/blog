---
title: Requests-HTMLæ¨¡å—
date: 2020-10-13 04:52:39
permalink: /pages/abbec5/
categories:
  - python
  - Pythonçˆ¬è™«æ¡ˆä¾‹
tags:
  - 
---
å®˜æ–¹æ–‡æ¡£ï¼š[http://html.python\-requests.org](https://links.jianshu.com/go?to=http%3A%2F%2Fhtml.python-requests.org)

ä¸­æ–‡æ–‡æ¡£ï¼š[https://cncert.github.io/requests\-html\-doc\-cn/#/?id=rebuild\_methodprepared\_request\-response](https://links.jianshu.com/go?to=https%3A%2F%2Fcncert.github.io%2Frequests-html-doc-cn%2F%23%2F%3Fid%3Drebuild_methodprepared_request-response)

GitHub:[https://github.com/Liangchengdeye/Requests\_Html\_Spider](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FLiangchengdeye%2FRequests_Html_Spider)

### ä¸€ã€ç®€ä»‹

1ã€ç¼–å†™çˆ¬è™«æ—¶requests+BeautifulSoupæ˜¯ä¸€å¯¹å®Œç¾çš„ç»„åˆï¼Œå…ˆé€šè¿‡requestsæ¨¡å—å°†ç½‘é¡µçˆ¬å–ä¸‹æ¥ï¼Œå†äº¤ç»™BeautifulSoupç­‰ä¸€äº›htmlè§£æåº“è¿›è¡Œè§£æï¼Œè€Œrequests\_htmlå¯ä»¥ç›´æ¥è§£æã€‚

2ã€ä¼˜ç‚¹

*   æ”¯æŒJavaScript
*   æ”¯æŒCSSé€‰æ‹©å™¨
*   æ”¯æŒxpathé€‰æ‹©å™¨
*   æ¨¡æ‹Ÿç”¨æˆ·ä»£ç†
*   è‡ªåŠ¨é‡å®šå‘
*   è¿æ¥æ± å’ŒcookieæŒä¹…æ€§
*   æ”¯æŒå¼‚æ­¥

Tipsï¼šçœ‹æ–‡æ¡£è¯´è¿™ä¸ªæ¨¡å—åªæ”¯æŒpy3.6ï¼Œä½†è¿™ä¸ªåº“è¿˜åœ¨æ›´æ–°ï¼Œæ‰€ä»¥py3.6åŠä»¥ä¸Šç‰ˆæœ¬åº”è¯¥éƒ½èƒ½ç”¨ã€‚

3ã€å®‰è£…
`pip install requests-html`

### äºŒã€ä½¿ç”¨

1ã€è¯·æ±‚ç½‘é¡µ

```python
from requests_html import HTMLSession
session = HTMLSession()
å‚æ•°ï¼š
      browser.args = [
      '--no-sand',
      '--user-agent = XXXXX'
      ]

æ¯”å¦‚ï¼š
session = HTMLSession(
    browser_args=[
        '--no-sand',
        '--user-agent=è®¡ç®—æœºé…ç½®'
    ]  # , headless=False  # âš ï¸å»æ”¹æºç 
)

getè¯·æ±‚å‚æ•°ï¼š
    url ã€è¯·æ±‚çš„è·¯ç”±ã€‘
    headers = {}  ã€å¤´éƒ¨ä¿¡æ¯ã€‘ ä¼˜å…ˆçº§é«˜äºcookie
    params = {}  ã€å‚æ•°ã€‘
    proxies = {'http':'http://ç«¯å£:ip'}  ã€ä»£ç†IPã€‘
    timeout = 0.5  ã€ç½‘é¡µå“åº”è¶…æ—¶æ—¶é—´ã€‘
    allow_redirects = False  ã€æ˜¯å¦å…è®¸é‡å®šå‘ï¼Œé»˜è®¤Trueã€‘

postè¯·æ±‚å‚æ•°ï¼š
    url ã€è¯·æ±‚çš„è·¯ç”±ã€‘
    header = {}  ã€å¤´éƒ¨ä¿¡æ¯ã€‘
    cookies = {} ã€headerä¸­æœ‰cookieä¿¡æ¯ï¼Œå¦å¤–å•ç‹¬ä¼ å…¥cookieã€‘
    data = {}  ã€postè¯·æ±‚æ•°æ®æ˜¯æ”¾åœ¨æ•°æ®ä½“ä¸­çš„ã€‘
    json = {}  ã€jsonæ ¼å¼çš„æ•°æ®ã€‘
    files = {'file':open(...,'rb')} ã€æ–‡ä»¶æ•°æ®ã€‘
    timeout = 0.5  ã€ç½‘é¡µå“åº”è¶…æ—¶æ—¶é—´ã€‘
    allow_redirects = False  ã€æ˜¯å¦å…è®¸é‡å®šå‘ï¼Œé»˜è®¤Trueã€‘

```

```python
âš ï¸æºç æ”¹åŠ¨3å¤„
ï¼ˆ1ï¼‰from requests_html import HTMLSession è¿›å…¥
ï¼ˆ2ï¼‰class HTMLSession(BaseSession):
        def __init__(self, **kwargs):
            super(HTMLSession, self).__init__(**kwargs)
ï¼ˆ3ï¼‰å› ä¸ºç»§æ‰¿çš„æ˜¯BaseSessionï¼Œæ‰€ä»¥è¿›å…¥BaseSessionä¿®æ”¹ä¸‰å¤„åœ°æ–¹

```

![](https://upload-images.jianshu.io/upload_images/12297445-a0f6abae225b4f63.png?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp)

å°†å¤´éƒ¨å†™æ´»

![](https://upload-images.jianshu.io/upload_images/12297445-ac85a38daf2a0516.png?imageMogr2/auto-orient/strip|imageView2/2/w/1104/format/webp)

æ·»åŠ å¤´éƒ¨

2ã€å“åº”

```bash
url = "è¦è¯·æ±‚çš„ç½‘é¡µé“¾æ¥"
å“åº”å¯¹è±¡ = session.get(url=url)
å“åº”å¯¹è±¡ = session.post(url=url)
å“åº”å¯¹è±¡ = session.request(method='get/post',url=url)

å“åº”å±æ€§ï¼š
  å“åº”å¯¹è±¡.url ã€è·å–urlã€‘
  å“åº”å¯¹è±¡.text  ã€è·å–å“åº”æ–‡æœ¬ã€‘
  å“åº”å¯¹è±¡.encoding = 'GBK/UTF_8'  ã€è®¾ç½®ç½‘é¡µç¼–ç ã€‘
  å“åº”å¯¹è±¡.content  ã€è·å–ç½‘é¡µä¸Šçš„äºŒè¿›åˆ¶å›¾ç‰‡ã€è§†é¢‘ã€‘
  å“åº”å¯¹è±¡.json()  ã€è·å–jsonæ ¼å¼æ•°æ®ã€‘
  å“åº”å¯¹è±¡.status_code  ã€çŠ¶æ€ç ã€‘
  å“åº”å¯¹è±¡.headers  ã€è·å–å¤´éƒ¨ä¿¡æ¯ã€‘
  å“åº”å¯¹è±¡.cookies ã€è·å–cookiesä¿¡æ¯ã€‘
  å“åº”å¯¹è±¡.history  ã€è·å–å†å²ä¿¡æ¯ã€‘

```

3ã€è§£æ
è¿™ä¸ªåº“æ˜¯è§£æHTMLï¼Œæ‰€ä»¥è§£æçš„éƒ½æ˜¯htmlå¯¹è±¡

(1) htmlå¯¹è±¡å±æ€§(å€¼)ï¼š

```tsx
  å“åº”å¯¹è±¡.html.absolute_links  ã€ç»å¯¹è·¯å¾„ï¼Œè‡ªåŠ¨æ·»åŠ http://ï¼Œè‡ªåŠ¨è¡¥å…¨å’Œå…¶ä»–é“¾æ¥åœ°å€ä¸€æ ·ï¼Œè¿”å›çš„é“¾æ¥è‡ªåŠ¨è½¬ä¸ºç»å¯¹è·¯å¾„ã€‘
  å“åº”å¯¹è±¡.html.links ã€ä»¥åˆ—è¡¨å½¢å¼æå–ã€è¿”å›å“åº”æºç ä¸­çš„æ‰€æœ‰urlé“¾æ¥ã€‘
  å“åº”å¯¹è±¡.html.base_url  ã€åŸºç¡€è·¯å¾„ï¼Œå°±æ˜¯ä¸»è·¯å¾„ï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸ªç½‘ç«™çš„ç½‘å€ã€‘
  å“åº”å¯¹è±¡.html.html  ã€htmlç½‘é¡µã€‘
  å“åº”å¯¹è±¡.html.text  ã€ç½‘é¡µä¸­çš„æ–‡æœ¬å†…å®¹ã€‘
  å“åº”å¯¹è±¡.html.encoding  ã€è·å–ç¼–ç æ–¹å¼ã€‘
  å“åº”å¯¹è±¡.html.encoding='GBK'  ã€è¾“å‡ºçš„æ–‡æœ¬å‡ºç°ä¹±ç ï¼Œè¿™æ—¶å°±éœ€è¦æŒ‡å®šç¼–ç æ–¹å¼ï¼ŒğŸ“åœ¨æ§åˆ¶å°è¾“å…¥document.charsetæŸ¥çœ‹ç¼–ç ç±»å‹ã€‘
  å“åº”å¯¹è±¡.html.raw_html  ã€æœªè§£æè¿‡çš„ç½‘é¡µã€‘
  å“åº”å¯¹è±¡.html.pq  ã€<class 'pyquery.pyquery.PyQuery'> pyqueryå¯¹è±¡ã€‘
```

âœ¨ğŸ°âœ¨(2) htmlå¯¹è±¡æ–¹æ³•ï¼š

*   å“åº”å¯¹è±¡.html.find () â€”â€” ä½¿ç”¨cssè§£æå™¨

```php
r.html.find('cssé€‰æ‹©å™¨')
r.html.find('cssé€‰æ‹©å™¨',first=True)
r.html.find('#footer')  # æŸ¥æ‰¾footeræ ‡ç­¾å…ƒç´ å¯¹è±¡
r.html.find('a',first=True)  # æŸ¥æ‰¾ç¬¬ä¸€ä¸ªaæ ‡ç­¾å…ƒç´ å¯¹è±¡
```

â€ƒğŸ‹findå‡½æ•°æœ‰5ä¸ªå‚æ•°ï¼š

```
â€ƒselectorã€cssè§£æå¼ï¼Œè¦ç”¨çš„CSSé€‰æ‹©å™¨ã€‘
â€ƒfirst ã€å¸ƒå°”å€¼ï¼Œå¦‚æœä¸ºçœŸåˆ™è¡¨ç¤ºè·å–ç¬¦åˆcssè¡¨è¾¾å¼çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¯¹è±¡ï¼Œå¦åˆ™è¿”å›æ»¡è¶³æ¡ä»¶çš„å…ƒç´ å¯¹è±¡åˆ—è¡¨ã€‘
â€ƒcontainingã€å¦‚æœæŒ‡å®šï¼Œåˆ™åªè¿”å›åŒ…å«æä¾›æ–‡æœ¬çš„å…ƒç´ ï¼Œæ”¾åœ¨åˆ—è¡¨ä¸­ã€‘
â€ƒcleanã€å¸ƒå°”å€¼ï¼Œæ˜¯å¦æ¶ˆé™¤ <script> å’Œ<style> æ ‡ç­¾å¯¹htmläº§ç”Ÿçš„å½±å“ã€‘
â€ƒ\_encodingã€ç¼–ç æ–¹å¼ã€‘
```
â€ƒğŸ‹å› ä¸ºå‡½æ•°è·å¾—çš„æ˜¯å…ƒç´ ï¼Œæ‰€ä»¥å…ƒç´ è¿˜æœ‰ä»–çš„å±æ€§

```ruby
----- å“åº”å¯¹è±¡.html.find().text ----
r.html.find('a', first=True).text  >>> è·å–å…ƒç´ çš„æ–‡æœ¬å†…å®¹
>>>è¾“å‡ºï¼šæ ¡èŠ±ç½‘
```

```python
----- å“åº”å¯¹è±¡.html.find().attrs ----
r.html.find('a', first=True)  >>> æŸ¥æ‰¾å…ƒç´ å¯¹è±¡
r.html.find('a', first=True).attrs)  >>>è·å–å…ƒç´ æ‰€æœ‰çš„å±æ€§
r.html.find('a', first=True).attrs['href'] >>> è·å–å…ƒç´ çš„å…·ä½“å±æ€§ï¼Œè¿”å›å€¼æ˜¯ä¸ªå­—å…¸

>>>è¾“å‡ºï¼š
>>>  <Element 'a' href='http://www.xiaohuar.com' title='æ ¡èŠ±ç½‘'>
>>>  {'href': 'http://www.xiaohuar.com', 'title': 'æ ¡èŠ±ç½‘'}
>>>  http://www.xiaohuar.com

```

```php
----- å“åº”å¯¹è±¡.html.find().html ----
r.html.find('a', first=True).html  >>> æŸ¥æ‰¾htmlå†…å®¹
>>>è¾“å‡º <a href="http://www.xiaohuar.com" title="&#x6821;&#x82B1;&#x7F51;">æ ¡èŠ±ç½‘</a>

```

---

â­•ï¸CSSé€‰æ‹©å™¨ï¼š
â€ƒâ€ƒ(1) ç±»åé€‰æ‹©å™¨
â€ƒâ€ƒâ€ƒâ€ƒclass â€”â€”> .ç±»å
â€ƒâ€ƒ(2) idé€‰æ‹©å™¨
â€ƒâ€ƒâ€ƒâ€ƒid â€”â€”> #idå
â€ƒâ€ƒ(3) æ ‡ç­¾é€‰æ‹©å™¨
â€ƒâ€ƒâ€ƒâ€ƒp â€”â€”> æ ‡ç­¾p
â€ƒâ€ƒ(4) åä»£é€‰æ‹©å™¨
â€ƒâ€ƒâ€ƒâ€ƒæ‰€æœ‰ï¼šå„¿å­ï¼Œå­™å­ï¼Œé‡å­™...
â€ƒâ€ƒâ€ƒâ€ƒul li a
â€ƒâ€ƒ(5) å­é€‰æ‹©å™¨
â€ƒâ€ƒâ€ƒâ€ƒåªæœ‰å„¿å­
â€ƒâ€ƒâ€ƒâ€ƒul li
â€ƒâ€ƒ(6) å±æ€§é€‰æ‹©å™¨(5ç§)
```
â€ƒâ€ƒâ€ƒâ€ƒ\[å±æ€§\] ç”¨äºé€‰å–å¸¦æœ‰æŒ‡å®šå±æ€§çš„å…ƒç´ 
â€ƒâ€ƒâ€ƒâ€ƒ\[å±æ€§=å€¼\] ç”¨äºé€‰å–å¸¦æœ‰æŒ‡å®šå±æ€§å’Œå€¼çš„å…ƒç´ 
â€ƒâ€ƒâ€ƒâ€ƒ\[å±æ€§^=å€¼\] åŒ¹é…å±æ€§å€¼ä»¥æŒ‡å®šå€¼å¼€å¤´çš„æ¯ä¸ªå…ƒç´ 
â€ƒâ€ƒâ€ƒâ€ƒ\[å±æ€§$=å€¼\] åŒ¹é…å±æ€§å€¼ä»¥æŒ‡å®šå€¼ç»“å°¾çš„æ¯ä¸ªå…ƒç´ 
â€ƒâ€ƒâ€ƒâ€ƒ\[å±æ€§~=å€¼\] ç”¨äºé€‰å–å±æ€§å€¼ä¸­åŒ…å«æŒ‡å®šè¯æ±‡çš„å…ƒç´ 
â€ƒâ€ƒâ€ƒâ€ƒ\[å±æ€§=\*å€¼\] åŒ¹é…å±æ€§å€¼ä¸­åŒ…å«æŒ‡å®šå€¼çš„æ¯ä¸ªå…ƒç´ 
```
â€ƒâ€ƒ(7) ç¾¤ç»„é€‰æ‹©å™¨
â€ƒâ€ƒâ€ƒâ€ƒé€‰æ‹©å™¨1ï¼Œé€‰æ‹©å™¨2... ç›¸å½“äºor
â€ƒâ€ƒ(8) å¤šæ¡é€‰æ‹©å™¨
â€ƒâ€ƒâ€ƒâ€ƒé€‰æ‹©å™¨1é€‰æ‹©å™¨2... ç›¸å½“äºand

æ›´å¤šç”¨æ³•ï¼š[https://www.w3school.com.cn/cssref/css\_selectors.asp](https://links.jianshu.com/go?to=https%3A%2F%2Fwww.w3school.com.cn%2Fcssref%2Fcss_selectors.asp)

---

*   å“åº”å¯¹è±¡.html.xpath() â€”â€” ä½¿ç”¨pathè§£æå™¨

```python
r.html.xpath('xpathé€‰æ‹©å™¨')
r.html.xpath('xpathé€‰æ‹©å™¨',first=True)

h.html.xpath("//div[@id='menu']/a")
h.html.xpath("//div[@id='menu']",first=True

```

å‚æ•°å’Œå±æ€§å‚ç…§cssé€‰æ‹©å™¨ã€‚

---

â­•ï¸XPathé€‰æ‹©å™¨
è¯­æ³•ï¼š
(1) é€‰å–èŠ‚ç‚¹

| è¡¨è¾¾å¼ | æè¿° |
| --- | --- |
| nodename | é€‰å–æ­¤èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹ |
| / | ä»æ ¹èŠ‚ç‚¹é€‰å– |
| // | ä»åŒ¹é…é€‰æ‹©çš„å½“å‰èŠ‚ç‚¹é€‰æ‹©æ–‡æ¡£ä¸­çš„èŠ‚ç‚¹ï¼Œè€Œä¸è€ƒè™‘å®ƒä»¬çš„ä½ç½® |
| . | é€‰å–å½“å‰èŠ‚ç‚¹ |
| .. | é€‰å–å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ |
| @ | é€‰å–å±æ€§ |

å®ä¾‹ğŸŒ°

| è·¯å¾„è¡¨è¾¾å¼ | ç»“æœ |
| --- | --- |
| bookstore | é€‰å– bookstore å…ƒç´ çš„æ‰€æœ‰å­èŠ‚ç‚¹ |
| /bookstore | é€‰å–æ ¹å…ƒç´  bookstoreã€‚
æ³¨é‡Šï¼šå‡å¦‚è·¯å¾„èµ·å§‹äºæ­£æ–œæ ( / )ï¼Œåˆ™æ­¤è·¯å¾„å§‹ç»ˆä»£è¡¨åˆ°æŸå…ƒç´ çš„ç»å¯¹è·¯å¾„ï¼ |
| bookstore/book | é€‰å–å±äº bookstore çš„å­å…ƒç´ çš„æ‰€æœ‰ book å…ƒç´  |
| //book | é€‰å–æ‰€æœ‰ book å­å…ƒç´ ï¼Œè€Œä¸ç®¡å®ƒä»¬åœ¨æ–‡æ¡£ä¸­çš„ä½ç½® |
| bookstore//book | é€‰æ‹©å±äº bookstore å…ƒç´ çš„åä»£çš„æ‰€æœ‰ book å…ƒç´ ï¼Œè€Œä¸ç®¡å®ƒä»¬ä½äº bookstore ä¹‹ä¸‹çš„ä»€ä¹ˆä½ç½® |
| //@lang | é€‰å–åä¸º lang çš„æ‰€æœ‰å±æ€§ |

(2)è°“è¯­ï¼šç”¨æ¥æŸ¥æ‰¾æŸä¸ªç‰¹å®šçš„èŠ‚ç‚¹æˆ–è€…åŒ…å«æŸä¸ªæŒ‡å®šçš„å€¼çš„èŠ‚ç‚¹
å®ä¾‹ğŸŒ°

| è·¯å¾„è¡¨è¾¾å¼ | ç»“æœ |
| --- | --- |
| /bookstore/book\[1\] | é€‰å–å±äº bookstore å­å…ƒç´ çš„ç¬¬ä¸€ä¸ª book å…ƒç´  |
| /bookstore/book\[last()\] | é€‰å–å±äº bookstore å­å…ƒç´ çš„æœ€åä¸€ä¸ª book å…ƒç´  |
| /bookstore/book\[last()\-1\] | é€‰å–å±äº bookstore å­å…ƒç´ çš„å€’æ•°ç¬¬äºŒä¸ª book å…ƒç´  |
| /bookstore/book\[position()<3\] | é€‰å–æœ€å‰é¢çš„ä¸¤ä¸ªå±äº bookstore å…ƒç´ çš„å­å…ƒç´ çš„ book å…ƒç´  |
| //title\[@lang\] | é€‰å–æ‰€æœ‰æ‹¥æœ‰åä¸º lang çš„å±æ€§çš„ title å…ƒç´  |
| //title\[@lang='eng'\] | é€‰å–æ‰€æœ‰ title å…ƒç´ ï¼Œä¸”è¿™äº›å…ƒç´ æ‹¥æœ‰å€¼ä¸º eng çš„ lang å±æ€§ |
| /bookstore/book\[price>35.00\] | é€‰å– bookstore å…ƒç´ çš„æ‰€æœ‰ book å…ƒç´ ï¼Œä¸”å…¶ä¸­çš„ price å…ƒç´ çš„å€¼é¡»å¤§äº 35.00 |
| /bookstore/book\[price>35.00\]/title | é€‰å– bookstore å…ƒç´ ä¸­çš„ book å…ƒç´ çš„æ‰€æœ‰ title å…ƒç´ ï¼Œä¸”å…¶ä¸­çš„ price å…ƒç´ çš„å€¼é¡»å¤§äº 35.00 |

(3) é€‰å–æœªçŸ¥èŠ‚ç‚¹

| é€šé…ç¬¦ | æè¿° |
| --- | --- |
| \* | åŒ¹é…ä»»ä½•å…ƒç´ èŠ‚ç‚¹ |
| @\* | åŒ¹é…ä»»ä½•å±æ€§èŠ‚ç‚¹ |
| node() | åŒ¹é…ä»»ä½•ç±»å‹çš„èŠ‚ç‚¹ |

å®ä¾‹ğŸŒ°

| è·¯å¾„è¡¨è¾¾å¼ | ç»“æœ |
| --- | --- |
| /bookstore/\* | é€‰å– bookstore å…ƒç´ çš„æ‰€æœ‰å­å…ƒç´  |
| //\* | é€‰å–æ–‡æ¡£ä¸­çš„æ‰€æœ‰å…ƒç´  |
| //title\[@\*\] | é€‰å–æ‰€æœ‰å¸¦æœ‰å±æ€§çš„ title å…ƒç´  |

(4) é€‰å–è‹¥å¹²è·¯å¾„
å®ä¾‹ğŸŒ°ï¼šé€šè¿‡åœ¨è·¯å¾„è¡¨è¾¾å¼ä¸­ä½¿ç”¨â€œ|â€è¿ç®—ç¬¦ï¼Œå¯ä»¥é€‰å–è‹¥å¹²ä¸ªè·¯å¾„

| è·¯å¾„è¡¨è¾¾å¼ | ç»“æœ |
| --- | --- |
| //book/title ç«–æ  //book/price | é€‰å– book å…ƒç´ çš„æ‰€æœ‰ title å’Œ price å…ƒç´  |
| //title ç«–æ  //price | é€‰å–æ–‡æ¡£ä¸­çš„æ‰€æœ‰ title å’Œ price å…ƒç´  |
| /bookstore/book/title ç«–æ  //price | é€‰å–å±äº bookstore å…ƒç´ çš„ book å…ƒç´ çš„æ‰€æœ‰ title å…ƒç´ ï¼Œä»¥åŠæ–‡æ¡£ä¸­æ‰€æœ‰çš„ price å…ƒç´  |

æ›´å¤šç”¨æ³•ï¼š[https://www.w3school.com.cn/xpath/index.asp](https://links.jianshu.com/go?to=https%3A%2F%2Fwww.w3school.com.cn%2Fxpath%2Findex.asp)

---

*   å“åº”å¯¹è±¡.html.search() â€”â€” æœç´¢å…ƒç´ çš„æ–‡æœ¬å†…å®¹

```bash
r.html.search('æ¨¡æ¿')  # æŸ¥å‡ºä¸€ä¸ª
r.html.search_all('æ¨¡æ¿')  # æŸ¥å‡ºæ‰€æœ‰

```

```bash
ğŸŒ°ï¼šr.html.search('æˆ‘è§‰å¾—å¾ˆæœ‰{}ç†')[0]  >>>è¾“å‡ºï¼šé“
    r.html.search('æˆ‘è§‰å¾—å¾ˆ{a}é“{test}')['test']  >>>è¾“å‡ºï¼šç†

ğŸ¨tipsï¼šå¦‚æœæ²¡æœ‰æ‰¾åˆ°çš„è¯è¿”å›ç½‘é¡µ

```

*   å“åº”å¯¹è±¡.html.render() â€”â€” JavaScriptæ”¯æŒ
    å†…ç½®æ”¯æŒjsæ¸²æŸ“ï¼Œå¯¹ä»¥å¾€éœ€è¦ä½¿ç”¨Seleniumè·å–æºç çš„é¡µé¢å¯ä¸å†é¢å¤–ä½¿ç”¨Seleniumåº“æ“ä½œã€‚
    renderæ–¹æ³•å°†ä¼šæ¸²æŸ“é¡µé¢çš„JavaScriptï¼Œè¿”å›æ¸²æŸ“åçš„æ•°æ®ã€‚
    ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼šåœ¨åˆæ¬¡ä½¿ç”¨è¯¥åŠŸèƒ½çš„æ—¶å€™ä¼šè‡ªåŠ¨ä¸‹è½½æ”¯æŒåŒ…ï¼šChromium

```swift
from requests_html import HTMLSession

session = HTMLSession()
r = session.get('http://python-requests.org/')
r.html.render()

```

ğŸ‹render()æ–¹æ³•å¯ç”¨å‚æ•°ï¼š
â€ƒâ€ƒretries ã€åœ¨Chromiumé‡ŒåŠ è½½é¡µé¢çš„é‡è¯•æ¬¡æ•°ã€‘
â€ƒâ€ƒscript ã€æ‰§è¡Œé¡µé¢ä¸Šçš„JavaScript (å¯é€‰å‚æ•°) ã€‘
â€ƒâ€ƒwait ã€é¡µé¢åŠ è½½å‰çš„ç­‰å¾…æ—¶é—´ï¼Œé˜²æ­¢è¶…æ—¶ (å•ä½ï¼šç§’ï¼Œå¯é€‰å‚æ•°) ã€‘
â€ƒâ€ƒscrolldown ã€æ¥æ”¶æ•´æ•°å‚æ•°nï¼Œå¦‚æœæä¾›å‚æ•°nï¼Œè¡¨ç¤ºå‘åç¿»né¡µã€‘
â€ƒâ€ƒsleep ã€åœ¨é¡µé¢åˆæ¬¡æ¸²æŸ“ä¹‹åçš„ç­‰å¾…æ—¶é—´ã€‘
â€ƒâ€ƒreload ã€å¦‚æœä¸ºFalseï¼Œåˆ™ä¸ä¼šé‡æ–°ä»æµè§ˆå™¨åŠ è½½å†…å®¹ï¼Œè€Œæ˜¯è¯»å–å†…å­˜é‡Œçš„å†…å®¹ã€‘
â€ƒâ€ƒkeep\_page ã€å¦‚æœä¸ºTrueï¼Œå°†ä¼šå…è®¸ä½ é€šè¿‡r.html.pageä¸æµè§ˆå™¨é¡µé¢äº¤äº’ã€‘

ğŸ¨Tipsï¼šå¦‚æœscrolldownå’Œsleepéƒ½æŒ‡å®šï¼Œé‚£ä¹ˆç¨‹åºä¼šåœ¨æš‚åœç›¸åº”æ—¶é—´åï¼Œå†å¾€åç¿»é¡µé¢ï¼ˆå¦‚ï¼šscrolldown=10, sleep=1ï¼‰

```python
scripyï¼š"""( ) => {
â€‹       jsä»£ç 
â€‹       jsä»£ç 
â€‹       }
â€‹       """
â€‹       scrolldowï¼šn
â€‹       sleep:n
â€‹       keep_page:True/False

```

```tsx
()=>{
Object.defineProperties(navigator,{
        webdriver:{
        get: () => undefined
        }
    })

```

ğŸ‹ä¸æµè§ˆå™¨äº¤äº’
(1) é¡µé¢äº‹ä»¶ â€”â€” r.html.page.XXX

```python
----- æ ¼å¼ -----
async def å‡½æ•°å():  # å…ˆå®šä¹‰ä¸€ä¸ªå‡½æ•°
    await r.html.page.XXX  # äº¤äº’æ–¹å¼
session.loop.run_until_complete(å‡½æ•°å())  # è°ƒç”¨

 ----- äº¤äº’æ–¹å¼ -----
r.html.page.screenshot({"path":è·¯å¾„})  # æˆªå±
r.html.page.evaluate("""()=>{jsä»£ç }""")
r.html.page.cookies()
r.html.page.type('cssé€‰æ‹©å™¨','å†…å®¹',{'delay':100})
r.html.page.click('cssé€‰æ‹©å™¨')  # ç‚¹å‡»
r.html.page.focus('cssé€‰æ‹©å™¨')  # èšç„¦
r.html.page.hover('cssé€‰æ‹©å™¨')  # æ‚¬æµ®
r.html.page.waitForSelector('cssé€‰æ‹©å™¨')
r.html.page.waitFor(1000)  # ç­‰å¾…

```

(2) é”®ç›˜äº‹ä»¶ â€”â€” r.html.page.keyboard.XXX

```bash
r.html.page.keyboard.type('å’¸é±¼ä»Šå¤©åŠªåŠ›äº†æ²¡',{'delay':100})  # é”®ç›˜æ‰“å­—
r.html.page.keyboard.up('Shift')  # ShiftæŠ¬èµ·ï¼ŒæŒ‰é”®å¯ä»¥æ¢æˆåˆ«çš„
r.html.page.keyboard.down('Shift')  # ShiftæŒ‰ä¸‹
r.html.page.keyboard.press('ArrowLeft')  # ä¸€ç›´æŒ‰å·¦é”®è¿›è¡Œé€‰æ‹©

```

(3) é¼ æ ‡äº‹ä»¶ â€”â€” r.html.page.mouse.XXX

```bash
r.html.page.mouse.click(x,y,{  # ç‚¹å‡»
    'button'ï¼š'left',
    'click':1
    'delay':0
})
r.html.page.mouse.down({'button':'left'})  # é¼ æ ‡æŒ‰ä¸‹
r.html.page.mouse.up({'button':'left'}) # é¼ æ ‡æŠ¬èµ·
ğŸ·ä¸€èˆ¬upå’Œdownä¸€èµ·ä½¿ç”¨ï¼Œè¡¨ç¤ºç‚¹å‡»ä¸€ä¸‹
r.html.page.mouse.movie(x,y,{'steps':1})  # é¼ æ ‡ç§»åŠ¨ï¼Œæ­¥é•¿ä¸º1è¡¨ç¤ºç§»åŠ¨ä¸€æ­¥å°±åˆ°ï¼Œæ­¥é•¿è®¾ç½®çš„è¶Šå¤§ï¼Œåˆ™æ­¥æ•°è¶Šç»†ï¼Œç§»åŠ¨è¶Šæ…¢

```

---

ç»ƒä¹ ï¼š

```python
from requests_html import HTMLSession

session = HTMLSession(
    browser_args=[
        '--no-sand',
        '--user-agent=è‡ªå·±çš„ç”µè„‘é…ç½®'
    ]  # , headless=False  # âš ï¸å»æ”¹æºç 
)

url = 'http://www.google.com'
# r = session.request(method='get', url=url)
# print(dir(r.html.find('a',first=True)))
#
# a_element = r.html.find('#footer',first=True)
# print(a_element.attrs['name'])
# print(r.html.search_all('ï¼ˆæç¤ºï¼š{name}ï¼Œæœ€æ–°ç« èŠ‚å¯èƒ½ä¼š{pwd}ï¼Œç™»å½•ä¹¦æ¶å³å¯å®æ—¶æŸ¥çœ‹ã€‚ï¼‰')[0])

r = session.request(method='get', url='https://www.bilibili.com/')

scrapts = """
    ()=>{
        Object.defineProperties(navigator,{
        webdriver:{
        get:() => undefined
        }
    })}
"""

try:
    r.html.render(script=scrapts, sleep=1, keep_page=True)

    async def main():
        await r.html.page.screenshot({"path": '1.png', 'clip': {'x': 200, 'y': 200, 'width': 400, 'height': 400}})
        res = await r.html.page.evaluate("""
        ()=>{
            var a = document.querySelector("#list")
            return {'x':a.offsetLeft}
        }
        """)
        print(res)
        print(await r.html.page.cookies())
        await r.html.page.type('#kw', 'æ³·æ³½èæ‹‰', {'delay': 500})
        await r.html.page.waitForSelector('[name="tj_trnews"]')
        await r.html.page.click('[name="tj_trnews"]')
        await r.html.page.focus('[type="number"]')
        await r.html.page.keyboard.type('111', {'delay': 200})
        await r.html.page.hover('[data-stat-id="6f5c93b4d1baf5e9"]')
        await r.html.page.keyboard.type('å–œæ¬¢ä½ å•Š', {'delay': 200})
        await r.html.page.keyboard.down('Shift')
        for i in range(3):
            await r.html.page.keyboard.press('ArrowLeft', {'delay': 1000})
        await r.html.page.keyboard.up('Shift')
        await r.html.page.keyboard.up('Backspace')
        res = await r.html.page.evaluate('''
        ()=>{
            car a = document.querySelector('[alt="ã€ç©¶æçˆ†è‚ã€‘å¾·å…‹è¨æ–¯ä¸æ‹‰æ™®å…°å¾·çš„æ„Ÿä¼¤å¾€äº‹ï¼ˆæ˜æ—¥æ–¹èˆŸææ”¹ åŠ¨ç”»æ‰‹ä¹¦Â·å®Œæ•´ç‰ˆï¼‰"]')
            return {
                'x':a.x+a.width/2,
                'y':a.y+a.height/2
            }
        }
        ''')
        print(res)
        await r.html.page.mouse.movie(res['x'], res['y'], {'step': 200})
        await r.html.page.mouse.down({'button': 'right'})
        await r.html.page.mouse.up({'button': 'right'})
        await r.html.page.mouse.click(res['x'], res['y'])

        await r.html.page.waitFor(5000)
    session.loop.run_until_complete(main())
finally:
    session.close()

```

å®æˆ˜ï¼š

```python
1ã€æ ¡èŠ±ç½‘å›¾ç‰‡
# å¯¹é¡µç è¿›è¡Œåˆ†æ
# http://www.xiaohuar.com/hua/
# http://www.xiaohuar.com/list-1-1.html  ç¬¬2é¡µ
# http://www.xiaohuar.com/list-1-2.html  ç¬¬3é¡µ

import os
from requests_html import HTMLSession

# ç”Ÿæˆæ‰€æœ‰é¡µç url
def get_page_url():
    for i in range(46):
        yield 'http://www.xiaohuar.com/list-1-{}.html'.format(i)

session = HTMLSession()

# ç¬¬ä¸€é¡µè§£ææµ‹è¯•
url = "http://www.xiaohuar.com/list-1-0.html"

# è§£æé¡µé¢ï¼Œè·å–å›¾ç‰‡åå’Œurl
def parse_page(url):
    r = session.request(method='get', url=url)
    img_element_list = r.html.find('[class="img"] img')
    for img_element in img_element_list:
        file_name1 = img_element.attrs.get('alt').replace('/', '').replace('\\', '')
        # print(file_name)
        file_name = file_name1 + '.png'
        file_url: str = img_element.attrs.get('src')
        file_url = r.html.base_url[:-1] + file_url if not file_url.startswith("http") else file_url
        save_file(file_name, file_url)

# ä¿å­˜å›¾ç‰‡
def save_file(name, url):
    base_path = 'æ ¡èŠ±å›¾ç‰‡'
    file_path = os.path.join(base_path, name)
    r = session.get(url=url)
    with open(file_path, 'wb') as f:
        f.write(r.content)
        print('%sä¸‹è½½æˆåŠŸ' % name)

if __name__ == '__main__':
    for page_url in get_page_url():
        parse_page(page_url)

```

```python
2ã€æ ¡èŠ±ç½‘è§†é¢‘
"""
åˆ†æï¼šæ ¡èŠ±ç½‘è§†é¢‘åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯mp4æ ¼å¼çš„ï¼Œä¸€ç§æ˜¯m3u8æ ¼å¼çš„ï¼Œæ‰€ä»¥è¦åˆ†åˆ«è¿›è¡Œå¤„ç†
"""
from requests_html import HTMLSession
import os

session = HTMLSession()

# è·å–ç´¢å¼•é¡µurl
def get_index_page():
    for i in range(6):
        url = 'http://www.xiaohuar.com/list-3-%s.html' % i
        yield url

# è§£æç´¢å¼•é¡µè·å–è¯¦æƒ…é¡µurl
# è§£æè¯¦æƒ…é¡µ
def get_detail_page(url):
    r = session.get(url=url)
    for element in r.html.find('#images a[class="imglink"]'):
        yield element.attrs.get('href')

# è§£æè¯¦æƒ…é¡µè·å–è§†é¢‘urlï¼Œåå­—
# è·å¾—åå­—ï¼Œç±»å‹ï¼Œé“¾æ¥
def get_url_name(url):
    r = session.get(url=url)
    r.html.encoding = 'gbk'
    file_name = r.html.find("title", first=True).text.replace('\\', '')
    print(file_name)
    element = r.html.find('#media source', first=True)
    if element:
        vurl = element.attrs.get('src')
        vtype = 'mp4'
    else:
        vurl = r.html.search('var vHLSurl    = "{}";')[0]
        vtype = 'm3u8'
    return file_name, vurl, vtype

# ä¿å­˜æ–‡ä»¶
def save(file_name, vurl, vtype):
    if vtype == "mp4":
        file_name += ".mp4"
        r = session.get(url=vurl)
        with open(file_name, 'wb') as f:
            f.write(r.content)
    elif vtype == "m3u8":
        save_m3u8(file_name, vurl)

# å¤„ç†m3u8
# save_m3u8('xxx','https://www6.laqddcc.com/hls/2019/05/05/BRsIeDpx/playlist.m3u8')
def save_m3u8(file_name, vurl):
    if not os.path.exists(file_name):
        os.mkdir(file_name)
    r = session.get(url=vurl)
    m3u8_path = os.path.join(file_name, 'playlist.m3u8')
    with open(m3u8_path, 'wb') as f:
        f.write(r.content)
    for line in r.text:
        if line.endswith('ts'):
            ts_url = vurl.replace('playlist.m3u8', line)
            ts_path = os.path.join(file_name, line)
            r0 = session.get(url=ts_url)
            with open(ts_path, 'wb') as f:
                f.write(r0.content)

if __name__ == '__main__':
    for index_page in get_index_page():
        for detail_url in get_detail_page(index_page):
            file_name, vurl, vtype = get_url_name(detail_url)
            save(file_name, vurl, vtype)

```

```python
3ã€æ¨¡æ‹ŸçŸ¥ä¹ç™»å½•
"""
åˆ†æï¼šçŸ¥ä¹ç”¨å¯†ç ç™»å½•ï¼Œæ€»å…±å‘é€3æ¬¡è¯·æ±‚ï¼Œè¯·æ±‚è·¯ç”±ç›¸åŒï¼Œä½†è¯·æ±‚æ–¹å¼ä¸åŒï¼›éªŒè¯ç æœ‰ä¸¤ç§æ–¹å¼ï¼Œå­—æ¯éªŒè¯ç å’Œé€‰æ‹©å€’ç«‹æ–‡å­—éªŒè¯ç ï¼›ä¸¤ä¸ªåŠ å¯†ï¼ŒformdataåŠ å¯†å’ŒsignatureåŠ å¯†ã€‚
     3æ¬¡è¯·æ±‚ï¼šã€ç¬¬ä¸€æ¬¡ã€‘https://www.zhihu.com/api/v3/oauth/captcha?lang=en  getè¯·æ±‚æ£€æµ‹æ˜¯å¦éœ€è¦éªŒè¯ç ,ä¼ è¾“çš„æ˜¯jsonæ ¼å¼ï¼›
             ã€ç¬¬äºŒæ¬¡ã€‘https://www.zhihu.com/api/v3/oauth/captcha?lang=en  putè·å–éªŒè¯ç ï¼Œè¿”å›çš„æ˜¯base64æ ¼å¼çš„éªŒè¯ç ï¼›
             ã€ç¬¬ä¸‰æ¬¡ã€‘https://www.zhihu.com/api/v3/oauth/captcha?lang=en  postè¯·æ±‚å‘é€éªŒè¯ç ã€‚
     ä¸¤ç§éªŒè¯ç ï¼šlang=en è‹±æ–‡ï¼›lang=cn ä¸­æ–‡ã€‚
     signatureåŠ å¯†æ˜¯ä½¿ç”¨sha1å’Œhmacï¼›
     formdataåŠ å¯†æ˜¯é€šè¿‡å¯¼å…¥åŠ å¯†çš„jså‡½æ•°æ¥åè§£å‡ºçš„ã€‚
"""
import requests
import base64
import Image
from time import sleep
import hmac
from hashlib import sha1
import time
from urllib.parse import urlencode
import execjs
import json

class Zhihu(object):
    def __init__(self):
        self.session = requests.session()
        self.headers = {
            'referer': 'https://www.zhihu.com/signin?next=%2F',
            'user-agent': 'è‡ªå·±çš„ç”µè„‘é…ç½®'
        }
        self.picture = None  # å­˜éªŒè¯ç 
        self.signature = None  # å­˜ç­¾å
        self.picture_url = None  # å­˜éªŒè¯ç é“¾æ¥

    def getbasecookie(self):
        self.session.get(url='https://www.zhihu.com/signin?next=%2F', headers=self.headers)
        self.session.get(url='https://www.zhihu.com/api/v4/search/preset_words', headers=self.headers)
        # self.session.post(url='https://www.zhihu.com/udid', headers=self.headers)  # æœªçŸ¥

    def getcapture(self):
        # è·å–éªŒè¯ç æ–¹æ³•ï¼Œæœ‰æ—¶å€™ä¸ç”¨è·å–éªŒè¯ç å°±å¯ä»¥ç›´æ¥ç™»å½•
        # lang=enæ˜¯è‹±æ–‡å­—æ¯ï¼Œlang=cnæ˜¯é€‰å€’è¿‡æ¥çš„æ–‡å­—
        message = self.session.get(url='https://www.zhihu.com/api/v3/oauth/captcha?lang=en',
                                   headers=self.headers).json()  # getè¯·æ±‚æ£€æµ‹æ˜¯å¦éœ€è¦éªŒè¯ç ,ä¼ è¾“çš„æ˜¯jsonæ ¼å¼
        print(message)  # {'show_captcha':True/False}
        if message['show_captcha'] == False:  # å¦‚æœä¸éœ€è¦éªŒè¯ç 
            self.picture = ''
        else:
            self.picture_url = self.session.put(url='https://www.zhihu.com/api/v3/oauth/captcha?lang=en',
                                                headers=self.headers).json()  # putè·å–éªŒè¯ç ï¼Œè¿”å›çš„æ˜¯base64æ ¼å¼çš„éªŒè¯ç 
            # é‡‡ç”¨base64æ ¼å¼å°†éªŒè¯ç é€šè¿‡å›¾ç‰‡æ ¼å¼æ˜¾ç¤ºå‡ºæ¥
            with open('captcha.jpg', 'wb') as f:
                f.write(base64.b64decode(self.picture_url['img_base64']))
            image = Image.open('captcha.jpg')
            image.show()
            self.picture = input('è¯·è¾“å…¥éªŒè¯ç ï¼š')
            sleep(2)
            message1 = self.session.post(url='https://www.zhihu.com/api/v3/oauth/captcha?lang=en',data={'input_text':self.picture},headers=self.headers).json()  # postè¯·æ±‚å‘é€éªŒè¯ç 
            print(message1)

    def get_signature(self):
        # çŸ¥ä¹ç™»å½•çš„ä¸»è¦é—®é¢˜åœ¨äºæ‰¾åˆ°signatureï¼Œé‡ç‚¹
        a = hmac.new('d1b964811afb40118a12068ff74a12f4'.encode('utf-8'),digestmod=sha1)
        a.update('password'.encode('utf-8'))
        a.update(b'c3cef7c66a1843f8b3a9e6a1e3160e20')
        a.update(b'com.zhihu.web')
        a.update(str(int(time.time()*1000)).encode('utf-8'))
        self.signature = a.hexdigest()

    def Login_phone(self):
        # ç™»å½•
        data = {
            'client_id': 'c3cef7c66a1843f8b3a9e6a1e3160e20',
            'grant_type': 'password',
            'timestamp': str(int(time.time() * 1000)),
            'source': 'com.zhihu.web',
            'signature': self.signature,
            'username': '+8615151979063',
            'password': '88404620wpr',
            'captcha': self.picture,
            'lang': 'en',
            'utm_source': '',
            'ref_source': 'other_https://www.zhihu.com/signin?next=%2F',
        }

        headers = {
            'scheme': 'https',
            'accept': '*/*',
            'accept-encoding': 'gzip, deflate, br',
            'accept-language': 'zh-CN,zh;q=0.8',
            'cache-control': 'no-cache',
            # 'content-length':'412',
            'pragma': 'no-cache',
            'origin': 'https://www.zhihu.com',
            'user-agent':'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36 SE 2.X MetaSr 1.0',
            'content-type': 'application/x-www-form-urlencoded',
            'referer': 'https://www.zhihu.com/signin?next=%2F',
            'x-xsrftoken': self.session.cookies.get('_xsrf'),
            'x-requested-with': 'fetch',
            'x-ab-param': 'top_vipconsume=1;se_famous=1;se_featured=1;top_ebook=0;top_recall_exp_v1=1;se_topicdirect=2;li_ts_sample=old;qa_answerlist_ad=0;zr_ans_rec=gbrank;se_likebutton=0;se_d2q=0;top_root=0;pf_noti_entry_num=0;li_android_vip=0;se_limit=0;se_ltr_nn=0;se_time_threshold=0;top_gr_ab=0;pf_fuceng=1;ls_videoad=0;top_ydyq=X;qa_test=0;zr_art_rec=base;se_topiclabel=1;top_recall_exp_v2=1;ls_new_upload=0;zr_km_answer=open_cvr;se_webtimebox=0;se_backsearch=0;tp_meta_card=0;zr_search_xgb=0;zr_km_xgb_model=new_xgb;se_spb309=0;soc_special=0;li_album3_ab=0;li_se_xgb=0;se_p_slideshow=0;ls_fmp4=0;soc_bignew=1;soc_bigone=0;ug_zero_follow_0=0;zr_article_rec_rank=close;zr_km_paid_answer=0;se_ri=0;tp_sft_v2=d;zr_rec_answer_cp=close;se_agency= 0;tsp_hotctr=1;soc_notification=0;pf_foltopic_usernum=50;zr_video_rank=new_rank;se_whitelist=0;tp_sft=a;tp_header_style=1;ug_zero_follow=0;li_se_paid_answer=0;se_go_ztext=0;tp_topic_head=1;top_reason=1;li_qa_new_cover=0;se_expired_ob=0;top_recall_deep_user=1;tsp_lastread=0;li_qa_cover=old;li_price_test=1;tp_qa_metacard_top=top;se_rr=0;se_wannasearch=0;se_subtext=0;pf_creator_card=1;zr_km_tag=open;se_mclick1=0;se_movietab=1;top_v_album=1;ug_newtag=0;zr_km_slot_style=event_card;se_page_limit_20=1;se_zu_recommend=0;top_rank=0;zr_intervene=0;se_billboardsearch=0;se_new_topic=0;se_payconsult=0;soc_update=1;pf_feed=1;zr_answer_rec_cp=open;se_ltr_ck=0;tp_qa_metacard=1;top_universalebook=1;se_websearch=3;ug_goodcomment_0=1;ug_follow_answerer=0;zr_infinity_small=256;se_mclick=0;top_native_answer=1;li_hot_score_ab=0;zr_rel_search=base;zr_video_recall=current_recall;se_ad_index=10;se_college_cm=0;ug_fw_answ_aut_1=0;zr_video_rank_nn=new_rank;se_college=default;se_search_feed=N;ug_follow_topic_1=2;li_back=0;se_webrs=1;se_amovietab=1;top_new_feed=5;li_pay_banner_type=0;li_ebook_detail=1;se_preset_tech=0;se_colorfultab=1;tp_sticky_android=0;li_tjys_ec_ab=0;ug_follow_answerer_0=0;li_album_liutongab=0;li_se_kv=0;se_mobileweb=1;top_quality=0;se_lottery=0;top_test_4_liguangyi=1;zr_km_style=base;se_ios_spb309=0;se_auto_syn=0;tsp_vote=1;pf_newguide_vertical=0;tsp_childbillboard=1;li_se_album_card=0;se_ltr_gc=0;tp_qa_toast=1;tp_m_intro_re_topic=1;se_waterfall=0;top_hotcommerce=1;zr_infinity_a_u=close;se_webmajorob=0;se_zu_onebox=0;se_site_onebox=0',
            'x-zse-83': '3_2.0',
        }
        print(self.session.cookies.get('_xsrf'))
        print(urlencode(data))

        with open('çŸ¥ä¹åŠ å¯†js.js','r',encoding='utf-8') as f:
            js = execjs.compile(f.read())  # ä¼ å…¥unicodeå­—ç¬¦
            data = js.call(u'b',urlencode(data))  # data_dictä¸ºè¡¨å•æ•°æ®
            print(data)
        message = self.session.post(url='https://www.zhihu.com/api/v3/oauth/sign_in',headers=headers,data=data)
        message.encoding='utf-8'
        print(message.text)
        print(json.loads(message.text)['error']['message'])

    def target_url(self,url):
        text = self.session.get(url)
        return text.text

if __name__ == '__main__':
    zhihu = Zhihu()
    zhihu.getbasecookie()  # é¦–æ¬¡cookie
    zhihu.getcapture()  # éªŒè¯ç 
    zhihu.get_signature()  # signature
    zhihu.Login_phone()  # ç™»å½•
```
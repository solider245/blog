---
title: Git合并策略选项和示例
date: 2020-10-12 12:09:51
permalink: /pages/c359ed/
categories:
  - git入门
  - 使用分支
tags:
  - 
---
# Git合并策略选项和示例

当一项工作完成，经过测试并准备好将其合并回开发主线时，您的团队可以做出一些政策选择。 您的合并策略选项是什么？ 在本文中，我们将研究各种可能性，然后提供有关Atlassian如何运行的注释。 希望最终您将拥有确定最适合您团队的工具。

## Git合并策略

合并两个分支时会发生合并。 Git将使用两个（或更多）提交指针，并尝试在它们之间找到一个公共的基本提交。 Git有几种不同的方法来查找基本提交，这些方法称为“合并策略”。 一旦Git找到一个通用的基本提交，它将创建一个新的“合并提交”，将指定的合并提交的更改进行合并。 从技术上讲，合并提交是一个常规提交，恰好有两个父提交。

![](https://wac-cdn.atlassian.com/dam/jcr:2d3aef7f-6e1d-4e39-a5a5-97dd7714fdd2/what-is-a-merge.gif?cdnVersion=1084)

`git merge` 除非明确指定，否则将自动选择合并策略。 该 `git merge` 和 `git pull` 命令都可以通过一个 `-s` （策略）选项。 该 `-s` 选项可以附加所需合并策略的名称。 如果未明确指定，Git将根据提供的分支选择最合适的合并策略。 以下是可用合并策略的列表。

### 递归的

```
git merge -s recursive branch1 branch2
```

这在两个头上进行。 当拉出或合并一个分支时，递归是默认的合并策略。 此外，这可以检测和处理涉及重命名的合并，但当前无法使用检测到的副本。 当拉或合并一个分支时，这是默认的合并策略。

### 解决

```
git merge -s resolve branch1 branch2
```

这只能使用3向合并算法解析两个磁头。 它试图仔细检测cris\-cross合并歧义，通常被认为是安全且快速的。

### 章鱼

```
git merge -s octopus branch1 branch2 branch3 branchN
```

超过两个头的默认合并策略。 当超过一个分支时，章鱼会自动进入。 如果合并中有需要手动解决的冲突，章鱼将拒绝合并尝试。 它主要用于将相似特征的分支头捆绑在一起。

### 我们的

```
git merge -s ours branch1 branch2 branchN
```

我们的策略适用于N个分支机构。 输出合并结果始终是当前分支的合并结果 `HEAD` 。 “我们的”一词表示优先选择，实际上忽略了所有其他分支的所有更改。 它旨在用于组合相似特征分支的历史记录。

### 子树

```
git merge -s subtree branchA branchB
```

这是递归策略的扩展。 合并A和B时，如果B是A的子树，则首先更新B以反映A的树结构。此更新也对A和B之间共享的公共祖先树进行。

## Git合并策略的类型

### 明确合并

显式合并是默认的合并类型。 “显式”部分是他们创建一个新的合并提交。 这将更改提交历史记录，并明确显示执行合并的位置。 合并提交内容也很明显，因为它显示了哪些提交是合并提交的父级。 一些团队避免显式合并，因为可以说合并提交会在项目历史记录中添加“噪音”。

### 通过变基或快速合并进行隐式合并

显式合并创建合并提交，而隐式合并则不会。 隐式合并从指定的分支头获取一系列提交，并将它们应用于目标分支的顶部。 隐式合并由 [基准事件](https://www.atlassian.com/git/tutorials/rewriting-history/git-rebase) 或 [快速向前合并](https://www.atlassian.com/git/tutorials/using-branches/git-merge) 触发 。 隐式合并是从指定分支中临时选择提交。

### 压缩合并，通常不进行显式合并

隐式合并的另一种类型是壁球。 可以在 [交互式变基](https://www.atlassian.com/git/tutorials/rewriting-history/git-rebase) 过程中执行壁球 。 压缩合并将从目标分支获取提交，并将其合并或压缩为一个提交。 然后，此提交会附加到 `HEAD` 合并基础分支的。 壁球通常用于在合并过程中保持“干净的历史记录”。 目标合并分支可以具有频繁提交的详细历史记录。 压缩并合并后，目标分支的提交历史将成为单个压缩的“分支提交”。 该技术对于 `git workflows` 利用特征分支 很有用 。

## 递归Git合并策略选项

上面介绍的“递归”策略具有其自己的其他操作选项子集。

```
ours
```

不要与我们的合并策略混淆。 通过偏爱“我们的”版本，此选项无法完全自动解决。 如果没有冲突，则“他们”方面的更改会自动合并。

```
theirs
```

与“我们的”策略相反。 “他们的”选项在解决冲突时倾向于使用外国合并树。

```
patience
```

此选项会花费额外的时间来避免在不重要的匹配行上合并。 当要合并的分支差异很大时，最好使用此选项。

```
diff-algorithim
```

此选项允许指定显式的diff\-algorithim。 diff\-algorithims与 `[git diff](https://www.atlassian.com/git/tutorials/saving-changes/git-diff)`  命令 共享 。

```
ignore-*    ignore-space-change    ignore-all-space    ignore-space-at-eol    ignore-cr-at-eol
```

针对空白字符的一组选项。 与传递的选项的子集匹配的任何行都将被忽略。

```
renormalize
```

此选项在解决三向合并的同时对所有树git树运行签出和签入。 该选项旨在用于合并具有不同 `checkin` / `checkout` 状态的 分支 。

```
no-normalize
```

禁用重新规格化选项。 这将覆盖 `merge.renormalize` 配置变量。

```
no-renames
```

在合并过程中，此选项将忽略重命名的文件。

```
find-renames=n
```

这是默认行为。 递归合并将支持文件重命名。 该 `n` 参数可用于传递用于重命名相似性的阈值。 默认 `n` 值为 `100%.`

```
subtree
```

该选项是从\`subtree\`策略中借用的。 在策略作用于两棵树并修改如何使其在共享祖先上匹配的情况下，该选项改为作用于树的路径元数据以使其匹配。

## 我们的Git合并政策

Atlassian强烈喜欢使用显式合并。 原因很简单：显式合并为合并的功能提供了很好的可追溯性和上下文。 绝对鼓励在共享功能分支进行审阅之前对本地历史记录进行清理变基，但这完全不会改变策略。 它增强了它。